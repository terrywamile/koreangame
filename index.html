<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HangulMaster - Fixed</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

        :root {
            --bg-gradient: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
            --card-bg: #ffffff;
            --text-color: #5D4037;
            --accent-color: #FF6B81;
            --btn-pass: #a8edea; 
            --btn-fail: #fad0c4; 
            --font-main: "Jua", sans-serif;
        }

        body {
            margin: 0; padding: 0; height: 100vh;
            background: var(--bg-gradient);
            color: var(--text-color);
            font-family: var(--font-main);
            display: flex; justify-content: center; align-items: center;
            user-select: none;
        }

        #app { width: 100%; max-width: 480px; padding: 20px; text-align: center; }

        .screen { display: none; }
        .screen.active { display: block; animation: bounceIn 0.5s; }
        @keyframes bounceIn { 0% { transform: scale(0.9); opacity:0; } 100% { transform: scale(1); opacity:1;} }

        h1 { font-size: 3rem; color: white; margin: 0; text-shadow: 2px 2px 0 rgba(0,0,0,0.1); }
        h2 { color: white; font-size: 1.2rem; margin-bottom: 20px; opacity: 0.9; }

        .menu-container { height: 60vh; overflow-y: auto; padding: 10px; }
        .menu-btn {
            width: 100%; padding: 15px; margin: 10px 0;
            background: white; border: 4px solid white; border-radius: 25px;
            color: var(--text-color); font-family: var(--font-main); font-size: 1.4rem;
            cursor: pointer; display: flex; align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: 0.2s;
        }
        .menu-btn:hover { transform: translateY(-3px); border-color: var(--accent-color); }
        .icon-circle {
            background: #ff9a9e; width: 45px; height: 45px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            margin-right: 15px; color: white; font-size: 1.2rem;
        }

        .card {
            background: white; border-radius: 35px; padding: 20px;
            min-height: 400px; display: flex; flex-direction: column;
            justify-content: space-between; align-items: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15); border: 6px solid #fff;
            position: relative;
        }

        .word-area { font-size: 5rem; margin: 20px 0; color: var(--accent-color); }

        .play-btn {
            width: 80px; height: 80px; border-radius: 50%; border: none;
            background: #f8f9fa; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex; justify-content: center; align-items: center;
        }
        .play-btn:active { transform: scale(0.9); }
        .play-btn svg { width: 35px; height: 35px; fill: var(--accent-color); }

        .trans-area { font-size: 1.5rem; color: #888; visibility: hidden; min-height: 3rem; }
        .trans-area.visible { visibility: visible; }
        .sub-text { font-size: 1rem; color: #aaa; display:block; }

        .controls { display: flex; gap: 10px; width: 100%; margin-top: 20px; }
        .ctrl-btn { flex: 1; padding: 15px; border-radius: 20px; border: none; font-family: var(--font-main); font-size: 1.2rem; cursor: pointer; }
        .btn-no { background: var(--btn-fail); color: #822727; }
        .btn-yes { background: var(--btn-pass); color: #2c7a7b; }

        .stats-bar { display: flex; justify-content: space-between; color: white; font-size: 1.2rem; margin-bottom: 10px; }
        
        /* Debug Box */
        #debug-log { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: #333; color: #0f0; padding: 5px; 
            font-size: 10px; display: none; text-align: left; z-index: 9999;
        }
    </style>
</head>
<body>

<div id="debug-log">Debug Mode Active</div>

<div id="app">
    <div id="menu-screen" class="screen active">
        <h1>HangulMaster</h1>
        <h2>‚ú® Í∑ÄÏó¨Ïõå Edition ‚ú®</h2>
        
        <div class="menu-container">
            <button class="menu-btn" id="btn-l1">
                <div class="icon-circle">„Ñ±</div> Level 1: Letters
            </button>
            <button class="menu-btn" id="btn-l2">
                <div class="icon-circle">Í∞Ä</div> Level 2: Syllables
            </button>
            <button class="menu-btn" id="btn-l3">
                <div class="icon-circle">Îã¨</div> Level 3: Batchim
            </button>
            <button class="menu-btn" id="btn-l4">
                <div class="icon-circle">Îßê</div> Level 4: Words
            </button>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div class="stats-bar">
            <span>‚≠ê <span id="score-val">0</span></span>
            <span>üÉè <span id="rem-val">0</span></span>
        </div>

        <div class="card">
            <div style="position:absolute; top:-15px; background:#FF6B81; color:white; padding:5px 15px; border-radius:15px; font-size:0.9rem;" id="lvl-badge">Level 1</div>
            
            <div class="word-area" id="word-disp">...</div>

            <button class="play-btn" id="btn-audio">
                <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </button>

            <div class="trans-area" id="trans-disp">
                <span id="main-trans">Meaning</span>
                <span class="sub-text" id="sub-trans">pronunciation</span>
            </div>

            <div class="controls">
                <button class="ctrl-btn btn-no" id="btn-bad">Oops</button>
                <button class="ctrl-btn btn-yes" id="btn-good">Good!</button>
            </div>
        </div>
        <button onclick="location.reload()" style="background:none; border:none; color:white; margin-top:15px; cursor:pointer;">Exit / Restart</button>
    </div>

    <div id="finish-screen" class="screen">
        <h1>ÎÅù!</h1>
        <p style="color:white; font-size:1.5rem;">Great Job!</p>
        <button class="menu-btn" onclick="location.reload()" style="justify-content:center;">Play Again</button>
    </div>
</div>

<script>
    // --- 1. ERROR TRAPPING (Shows errors on screen) ---
    window.onerror = function(msg, url, line) {
        const d = document.getElementById('debug-log');
        d.style.display = 'block';
        d.innerHTML += "<br>ERROR: " + msg + " (Line " + line + ")";
        alert("Code Error: " + msg);
    };

    // --- 2. DATASETS (Cleaned) ---
    const dataL1=[{ko:"„Ñ±",audio:"Í∑∏",en:"g/k",rom:"giyok"},{ko:"„Ñ¥",audio:"Îäê",en:"n",rom:"nieun"},{ko:"„Ñ∑",audio:"Îìú",en:"d/t",rom:"digeut"},{ko:"„Ñπ",audio:"Î•¥",en:"r/l",rom:"rieul"},{ko:"„ÖÅ",audio:"ÎØÄ",en:"m",rom:"mieum"},{ko:"„ÖÇ",audio:"Î∏å",en:"b/p",rom:"bieup"},{ko:"„ÖÖ",audio:"Ïä§",en:"s",rom:"siot"},{ko:"„Öá",audio:"Ïúº",en:"ng",rom:"ieung"},{ko:"„Öà",audio:"Ï¶à",en:"j",rom:"jieut"},{ko:"„Öä",audio:"Ï∏†",en:"ch",rom:"chieut"},{ko:"„Öã",audio:"ÌÅ¨",en:"k",rom:"kieuk"},{ko:"„Öå",audio:"Ìä∏",en:"t",rom:"tieut"},{ko:"„Öç",audio:"ÌîÑ",en:"p",rom:"pieup"},{ko:"„Öé",audio:"Ìùê",en:"h",rom:"hieut"},{ko:"„Öè",en:"a",rom:"ah"},{ko:"„Öë",en:"ya",rom:"yah"},{ko:"„Öì",en:"eo",rom:"uh"},{ko:"„Öï",en:"yeo",rom:"yuh"},{ko:"„Öó",en:"o",rom:"oh"},{ko:"„Öõ",en:"yo",rom:"yoh"},{ko:"„Öú",en:"u",rom:"oo"},{ko:"„Ö†",en:"yu",rom:"yoo"},{ko:"„Ö°",en:"eu",rom:"eu"},{ko:"„Ö£",en:"i",rom:"ee"}];
    
    const dataL2=[{ko:"Í∞Ä",en:"ga"},{ko:"ÎÇò",en:"na"},{ko:"Îã§",en:"da"},{ko:"Îùº",en:"ra"},{ko:"Îßà",en:"ma"},{ko:"Î∞î",en:"ba"},{ko:"ÏÇ¨",en:"sa"},{ko:"ÏïÑ",en:"ah"},{ko:"Ïûê",en:"ja"},{ko:"Ï∞®",en:"cha"},{ko:"Ïπ¥",en:"ka"},{ko:"ÌÉÄ",en:"ta"},{ko:"Ìåå",en:"pa"},{ko:"Ìïò",en:"ha"},{ko:"Í±∞",en:"geo"},{ko:"ÎÑà",en:"neo"},{ko:"Îçî",en:"deo"},{ko:"Îü¨",en:"reo"},{ko:"Î®∏",en:"meo"},{ko:"Î≤Ñ",en:"beo"},{ko:"ÏÑú",en:"seo"},{ko:"Ïñ¥",en:"eo"},{ko:"Ï†Ä",en:"jeo"},{ko:"Íµ¨",en:"gu"},{ko:"ÎàÑ",en:"nu"},{ko:"Îëê",en:"du"},{ko:"Î£®",en:"ru"},{ko:"Î¨¥",en:"mu"},{ko:"Î∂Ä",en:"bu"},{ko:"Ïàò",en:"su"},{ko:"Ïö∞",en:"oo"},{ko:"Ï£º",en:"ju"}];
    
    const dataL3=[{ko:"Í∞Ñ",en:"gan"},{ko:"ÎÇú",en:"nan"},{ko:"Îã®",en:"dan"},{ko:"ÎûÄ",en:"ran"},{ko:"Îßå",en:"man"},{ko:"Î∞ò",en:"ban"},{ko:"ÏÇ∞",en:"san"},{ko:"Ïïà",en:"an"},{ko:"Ïûî",en:"jan"},{ko:"Ï∞¨",en:"chan"},{ko:"Í∞ê",en:"gam"},{ko:"ÎÇ®",en:"nam"},{ko:"Îã¥",en:"dam"},{ko:"Îûå",en:"ram"},{ko:"Îßò",en:"mam"},{ko:"Î∞§",en:"bam"},{ko:"ÏÇº",en:"sam"},{ko:"Ïïî",en:"am"},{ko:"Ïû†",en:"jam"},{ko:"Í∞ï",en:"gang"},{ko:"Î∞©",en:"bang"},{ko:"ÏÉÅ",en:"sang"},{ko:"Ïû•",en:"jang"},{ko:"Ìï≠",en:"hang"},{ko:"Í≥µ",en:"gong"},{ko:"Îèô",en:"dong"},{ko:"Î¥â",en:"bong"},{ko:"ÏÜ°",en:"song"},{ko:"Ï¢Ö",en:"jong"}];
    
    const dataL4=[{ko:"ÏïàÎÖïÌïòÏÑ∏Ïöî",en:"Hello",rom:"annyeong-haseyo"},{ko:"Í∞êÏÇ¨Ìï©ÎãàÎã§",en:"Thank you",rom:"gamsa-hamnida"},{ko:"ÎÑ§",en:"Yes",rom:"ne"},{ko:"ÏïÑÎãàÏöî",en:"No",rom:"aniyo"},{ko:"ÏÇ¨Îûå",en:"Person",rom:"saram"},{ko:"ÎÇ®Ïûê",en:"Man",rom:"namja"},{ko:"Ïó¨Ïûê",en:"Woman",rom:"yeoja"},{ko:"ÏπúÍµ¨",en:"Friend",rom:"chingu"},{ko:"ÌïôÍµê",en:"School",rom:"hakgyo"},{ko:"Ïßë",en:"House",rom:"jip"},{ko:"Î¨º",en:"Water",rom:"mul"},{ko:"Î∞•",en:"Rice/Meal",rom:"bap"},{ko:"Îπµ",en:"Bread",rom:"ppang"},{ko:"Ïò§Îäò",en:"Today",rom:"oneul"},{ko:"ÎÇ¥Ïùº",en:"Tomorrow",rom:"naeil"},{ko:"ÏÇ¨Îûë",en:"Love",rom:"sarang"}];

    // --- 3. STATE ---
    let queue = [];
    let current = null;
    let score = 0;

    // --- 4. FUNCTIONS ---
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function initGame(level) {
        try {
            let src = [];
            if(level===1) src = dataL1;
            else if(level===2) src = dataL2;
            else if(level===3) src = dataL3;
            else src = dataL4;

            // Clone and Shuffle
            queue = JSON.parse(JSON.stringify(src));
            queue.sort(() => Math.random() - 0.5);

            score = 0;
            updateUI();
            document.getElementById('lvl-badge').innerText = "Level " + level;
            showScreen('game-screen');
            nextCard();
        } catch(e) {
            alert("Start failed: " + e.message);
        }
    }

    function nextCard() {
        if(queue.length === 0) {
            showScreen('finish-screen');
            return;
        }
        current = queue.shift();
        
        document.getElementById('word-disp').innerText = current.ko;
        document.getElementById('main-trans').innerText = current.en;
        document.getElementById('sub-trans').innerText = current.rom ? "("+current.rom+")" : "";
        document.getElementById('trans-disp').classList.remove('visible');
        updateUI();
    }

    function updateUI() {
        document.getElementById('score-val').innerText = score;
        document.getElementById('rem-val').innerText = queue.length + (current?1:0);
    }

    function processResult(success) {
        document.getElementById('trans-disp').classList.add('visible');
        if(success) {
            score += 10;
        } else {
            queue.splice(2, 0, current); // Put back later
        }
        updateUI();
        setTimeout(nextCard, 500);
    }

    function playAudio() {
        if(!current) return;
        document.getElementById('trans-disp').classList.add('visible');
        const txt = current.audio || current.ko;
        const url = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(txt)}&tl=ko&client=tw-ob`;
        new Audio(url).play().catch(e => {
            // Fallback
            const u = new SpeechSynthesisUtterance(txt);
            u.lang = 'ko-KR';
            window.speechSynthesis.speak(u);
        });
    }

    // --- 5. EVENT LISTENERS (Safe Binding) ---
    // We bind events here to ensure HTML is ready
    window.onload = function() {
        console.log("System Ready");
        
        // Bind Menu Buttons
        document.getElementById('btn-l1').onclick = function() { initGame(1); };
        document.getElementById('btn-l2').onclick = function() { initGame(2); };
        document.getElementById('btn-l3').onclick = function() { initGame(3); };
        document.getElementById('btn-l4').onclick = function() { initGame(4); };

        // Bind Game Buttons
        document.getElementById('btn-audio').onclick = playAudio;
        document.getElementById('btn-bad').onclick = function() { processResult(false); };
        document.getElementById('btn-good').onclick = function() { processResult(true); };
        
        // Alert user of success load
        // Uncomment the next line if you want a popup confirmation
        // alert("Game Loaded Successfully!");
    };

</script>
</body>
</html>